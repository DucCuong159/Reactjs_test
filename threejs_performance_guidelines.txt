HƯỚNG DẪN TỐI ƯU HÓA HIỆU NĂNG THREE.JS (PERFORMANCE GUIDELINES)

Để ứng dụng 3D chạy mượt mà (60 FPS) và không làm treo máy người dùng, hãy tuân thủ 4 cấp độ tối ưu sau:

CẤP ĐỘ 1: QUẢN LÝ BỘ NHỚ (DISPOSAL) - CHIẾN ĐẤU VỚI MEMORY LEAK
- Vấn đề: GPU không tự động dọn dẹp khi object bị xóa khỏi scene.
- Giải pháp: Khi không dùng nữa, bạn MUST gọi:
  * geometry.dispose()
  * material.dispose()
  * texture.dispose()
- Trong React: Luôn thực hiện trong hàm cleanup của useEffect (return function).

CẤP ĐỘ 2: TÁI SỬ DỤNG (REUSE) - TIẾT KIỆM TÀI NGUYÊN
- Vấn đề: Tạo hàng chục vật thể giống nhau bằng cách khởi tạo mới Material/Geometry cho từng cái.
- Giải pháp: 
  * Tạo 1 biến sharedGeometry và 1 sharedMaterial duy nhất.
  * Dùng chúng để tạo ra nhiều Mesh (new THREE.Mesh(sharedGeo, sharedMat)).
  * Giúp giảm tải cho bộ nhớ VRAM và giúp GPU vẽ nhanh hơn.

CẤP ĐỘ 3: GIẢM DRAW CALLS (INSTANCING) - CHO SỐ LƯỢNG CỰC LỚN
- Vấn đề: CPU gửi quá nhiều lệnh vẽ (Draw Calls) riêng lẻ đến GPU.
- Giải pháp: 
  * Sử dụng THREE.InstancedMesh khi cần vẽ hàng ngàn vật thể giống hệt nhau (như cỏ, rừng cây, hoặc hàng trăm lá bài bay).
  * Chỉ mất 1 Draw Call duy nhất cho toàn bộ tập hợp đó.

CẤP ĐỘ 4: KIỂM SOÁT ĐIỂM ẢNH (PIXEL RATIO) - TIẾT KIỆM GPU
- Vấn đề: Các màn hình Retina/4K có mật độ điểm ảnh quá cao, GPU phải vẽ quá nhiều pixel không cần thiết.
- Giải pháp: 
  *renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  * Đừng bao giờ vượt quá 2. Mắt người không thấy khác biệt giữa 2 và 3, nhưng GPU sẽ phải làm việc gấp đôi.

CÁC MẸO KHÁC:
- Tắt đổ bóng (Shadows) nếu không thực sự cần thiết.
- Giảm độ mịn (Segments) của hình cầu/hình xuyến xuống mức thấp nhất mà vẫn nhìn ổn.
- Sử dụng Texture Atlas (gộp nhiều ảnh nhỏ vào 1 ảnh lớn) để giảm số lượng Texture switch.

Chúc bạn xây dựng được những ứng dụng 3D mượt mà nhất!
